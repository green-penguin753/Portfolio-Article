# 【MySQL】インデックスとは

インデックスとは、  
データベースに作成できる「索引」のことで、検索を高速化するための仕組み


- テーブル全体を全件検索(フルスキャン)することなく、必要なデータに直接アクセスできる。
  書籍の最後についている索引のようなもの。  


- インデックスは列(カラム)に対して作られる。

- インデックスの操作(作成・削除など)は、DDL 文の命令に含まれる。

- Primary Key は自動的にインデックスが作成される。
- 複合インデックスとは、複数の列を１つのインデックスとしてまとめたもの。

# 作成(CREATE)

`CREATE INDEX インデックス名 ON テーブル名(列名)`

```SQL
CREATE INDEX idx_customers_name ON customers(name);
```

☀︎customers テーブルの name カラムにインデックスを作成している。

# 変更(ALTER)

## 削除(DROP)

`ALTER TABLE テーブル名 DROP インデックス名`

```SQL
ALTER TABLE customers DROP INDEX idx_customers_name;
```

☀︎idx_customers_name という名前のインデックスを削除している。

- 削除もテーブル自体の構造を変更しているので`ALTER TABLE`を使う。

## 追加(ADD INDEX)

`ALTER TABLE テーブル名 ADD INDEX インデックス名(カラム名)`

```SQL
ALTER TABLE customers ADD INDEX idx_customers_created_date(created_date);
```

☀︎customers テーブルの created_date カラムにインデックスを追加(作成)している。

# 参照(SHOW)

`SHOW INDEX FROM データベース名.テーブル名`
データベース名は省略可能

```SQL
SHOW INDEX FROM db_01.customers;
```

☀︎customers テーブルにあるインデックスを確認する。

# 高速化の効果を測る(EXPLAIN)

`EXPLAIN PLAN`文でも可能

```SQL
EXPLAIN SELECT * FROM customers WHERE created_date IS NULL;
```

このクエリの実行計画の結果を見て、どのカラムにインデックスを張るべきか検討する。

### 効率の良いインデックスの張り方

インデックスによって検索は高速になるが、  
データを更新するときに追加の処理コストの発生や、ディスク容量を消費してしまう。

- 検索や並び替えでよく使う列
- JOIN の ON 句でよく使う Foreign key(外部キー)の列
- データの値の種類が多い(ガーディナリティが高い)列

###### 例 ①WHERE 句での絞り込み条件で使う列

```SQL
SELECT *
 FROM customers
 WHERE name
 LIKE ’John’;
```

- 完全一致検索や前方一致検索`’John%’`で効果が高く、  
  部分一致検索`’%John%’`や後方一致検索`’%John’`では、インデックスが使えない。

###### 例 ②ORDER BY 句の並び替えで使う列

```SQL
SELECT *
 FROM customers
 ORDER BY created_date;
```

###### 例 ③JOIN 結合で使う列

```SQL
SELECT *
 FROM customers
 JOIN id
 ON customers.id = orders.customer_id;
```

☀︎orders テーブルの customer_id カラムにインデックスを張るといい。

- 結合処理は内部で並び替えをしている。

---

### 参考にしたサイト

- https://qiita.com/pugiemonn/items/8a6b322654aa65e2966b
- https://proengineer.internous.co.jp/content/columnfeature/6818
- スッキリわかる SQL 入門 第４版 ドリル２５６問付き！
